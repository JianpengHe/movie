<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="screen-orientation" content="portrait" />
  <meta name="x5-orientation" content="portrait" />
  <meta name="renderer" content="webkit" />
  <meta charset="utf-8" />
  <title>电影订票系统登录</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: rgb(248, 248, 248);
    }

    #list {
      display: flex;
      flex-direction: column;
    }

    .list {
      background-color: #fff;
      margin: 10px;
      padding: 15px;
      display: flex;
      flex-direction: column;
      border-radius: 10px;
    }

    .title {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      color: #555;

    }

    .body {
      display: flex;
      margin: 10px 0;
    }

    .body img {
      display: block;
      width: 84px;
      height: 130px;
    }

    .body>div {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      margin: 15px;
      color: #555;
      font-size: 14px;
      line-height: 24px;
    }

    .filmName {
      font-size: 18px;
      color: #000;
    }

    hr {
      width: 100%;
      border-bottom: none;
      border-top: 1px solid rgba(50, 50, 50, 0.5);
    }

    .total {
      text-align: right;
      font-size: 14px;
    }
  </style>
</head>

<body>
  <div id="list">
  </div>
  <style>
    #foot {
      display: flex;
      position: fixed;
      bottom: 0;
      z-index: 1000;
      width: 100vw;
      background-color: #fff;
      padding: 10px 0px;
      box-shadow: 0 0 5px 1px rgb(0, 0, 0, .5);
    }

    #foot a {
      width: 100%;
      display: block;
      text-align: center;
      text-decoration: none;
      color: #aaa;
    }

    #foot p {
      margin: 0;
      line-height: 14px;
      font-size: 14px;
    } #foot svg {
      width: 25px;
      height: 25px;
    }
    #foot  .selected{
      color: #f00;
      
    }
    
    #foot  .selected svg{
      fill: #f00;
      
    }
    
  </style>
  <div style="height: 64px;"></div>
  <div id="foot">
    <a href="/" >
      <svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" >
        <path
          d="M155.584 342.56l312.874667-224.565333a74.666667 74.666667 0 0 1 87.082666 0l312.874667 224.565333A117.333333 117.333333 0 0 1 917.333333 437.866667V800c0 64.8-52.533333 117.333333-117.333333 117.333333H224c-64.8 0-117.333333-52.533333-117.333333-117.333333V437.877333a117.333333 117.333333 0 0 1 48.917333-95.317333z m37.322667 51.989333A53.333333 53.333333 0 0 0 170.666667 437.877333V800a53.333333 53.333333 0 0 0 53.333333 53.333333h576a53.333333 53.333333 0 0 0 53.333333-53.333333V437.877333a53.333333 53.333333 0 0 0-22.24-43.328L518.218667 169.984a10.666667 10.666667 0 0 0-12.437334 0L192.906667 394.56z">
        </path>
      </svg>
      <p>首页</p>
    </a>
    <a href="/">
      <svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" >
        <path
          d="M844.832 885.344c-30.485333-20.714667-77.781333-18.965333-144.053333 9.386667A425.024 425.024 0 0 1 512 938.666667C276.362667 938.666667 85.333333 747.637333 85.333333 512S276.362667 85.333333 512 85.333333s426.666667 191.029333 426.666667 426.666667a425.013333 425.013333 0 0 1-44.405334 189.717333 32 32 0 0 1-57.301333-28.490666A361.013333 361.013333 0 0 0 874.666667 512c0-200.298667-162.368-362.666667-362.666667-362.666667S149.333333 311.701333 149.333333 512s162.368 362.666667 362.666667 362.666667c56.704 0 111.488-13.013333 161.12-37.653334l1.6-0.746666c84.746667-36.437333 154.176-39.125333 206.08-3.861334a32 32 0 1 1-35.968 52.938667zM512 416a64 64 0 1 1 0-128 64 64 0 0 1 0 128z m160 160a64 64 0 1 1 0-128 64 64 0 0 1 0 128zM512 736a64 64 0 1 1 0-128 64 64 0 0 1 0 128zM352 576a64 64 0 1 1 0-128 64 64 0 0 1 0 128z">
        </path>
      </svg>
      <p>影院</p>
    </a>
    <a href="/List.html">
      <svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
        <path
          d="M544 661.333333a32 32 0 0 1-64 0V362.666667a32 32 0 0 1 64 0v298.666666z m160 0a32 32 0 0 1-64 0V490.666667a32 32 0 0 1 64 0v170.666666z m-320 0a32 32 0 0 1-64 0V448a32 32 0 0 1 64 0v213.333333zM202.666667 138.666667h618.666666c64.8 0 117.333333 52.533333 117.333334 117.333333v512c0 64.8-52.533333 117.333333-117.333334 117.333333H202.666667c-64.8 0-117.333333-52.533333-117.333334-117.333333V256c0-64.8 52.533333-117.333333 117.333334-117.333333z m0 64a53.333333 53.333333 0 0 0-53.333334 53.333333v512a53.333333 53.333333 0 0 0 53.333334 53.333333h618.666666a53.333333 53.333333 0 0 0 53.333334-53.333333V256a53.333333 53.333333 0 0 0-53.333334-53.333333H202.666667z">
        </path>
      </svg>
      <p>榜单</p>
    </a>
    <a href="/user.html" class="selected">
      <svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" >
        <path
          d="M821.333333 256a32 32 0 0 1 64 0v565.333333c0 64.8-52.533333 117.333333-117.333333 117.333334H256c-64.8 0-117.333333-52.533333-117.333333-117.333334V202.666667c0-64.8 52.533333-117.333333 117.333333-117.333334h597.333333a32 32 0 0 1 0 64H256a53.333333 53.333333 0 0 0-53.333333 53.333334v618.666666a53.333333 53.333333 0 0 0 53.333333 53.333334h512a53.333333 53.333333 0 0 0 53.333333-53.333334V256zM341.333333 437.333333a32 32 0 0 1 0-64h341.333334a32 32 0 0 1 0 64H341.333333z m0 170.666667a32 32 0 0 1 0-64h213.333334a32 32 0 0 1 0 64H341.333333z">
        </path>
      </svg>
      <p>订单</p>
    </a>
  </div>
</body>
<script>
  var time = function (a) {

    return `${String(Math.floor(a / 60)).padStart(2, "0")}:${String(a % 60).padStart(2, "0")}`
  }
  var Status = function (date1, time1, filmlong) {
    var date = new Date(date1.substring(0, 10) + " " + time(time1) + ":00").getTime() / 1000;
    var now = new Date().getTime() / 1000 //时间戳    new Date().getTime()得到的是毫秒数，当前时间要转换成秒除1000
    if (now < date) { return "待放映" }
    if (now < date + filmlong * 60) { return "正在放映" }
    return "已完成"
  }
  var xhr = new XMLHttpRequest();    //提供了一个通过 URL 来获取数据的简单方式 
  xhr.responseType = "json";  //服务器返回来的类型自动转换成对象
  xhr.open("get", "/api/orderlist");  //打开要发送的地址通道  向服务器发出一个HTTP请求，这里是HTTP请求是post
  xhr.send();  //.send()方法是用来发送post请求里面的body的，get方法直接.send（）
  xhr.onreadystatechange = function () {    // .onreadystatechange  当 readyState 属性改变时会调用它
    if (xhr.readyState === 4) {
      if (xhr.status === 401) {
        location.href = '/login.html'
      }
      if (xhr.status === 200) {
        document.getElementById("list").innerHTML = `<div class="list">我的订单</div>` + xhr.response.map(function (obj) {
          return `<div class="list">
      <div class="title">
        <div>${obj.cName}</div>
        <div>${Status(obj.date, obj.time, obj.filmlong)}</div>
      </div>
      <div class="body">
        <img src="${obj.fImage}" />
        <div>
          <div class="filmName">${obj.fName}</div>
          <div>${obj.date.substring(5, 10)} ${time(obj.time)}<br />${obj.hName} ${Math.floor(obj.seatid / 9) + 1}排${obj.seatid % 9 + 1}座</div>            
        </div>
       
      </div>
      <hr />
       <div class="total">总价：${obj.price / 1000}元</div>
    </div>`}).join("")
      }              // 用座位id来计算用户几排几座
    }
  };

</script>

</html>